<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-Control" content="no-cache,must-revalidate">
	<meta http-equiv="Expires" content="0">
	<!--如果是IE，会使用最新的渲染引擎进行渲染-->
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<link rel="stylesheet" type="text/css" href="./css/bootstrap/5/bootstrap.min.css"/>
	<link rel="stylesheet" type="text/css" href="./css/font-awesome/css/all.min.css"/>

	<script>
		let contextPath = './';
		let js_ver = '0000';
		// system encoding
		var systemEncode = 'SJIS';
		sessionStorage.setItem('systemEncode', systemEncode);
		// system language
		var sysLanguage = 'ja';
		sessionStorage.setItem('sysLanguage', sysLanguage);
		// bootstrap color picker option
		var btpColorPickerOption = {format: 'hex'};
		sessionStorage.setItem('btpColorPickerOption', btpColorPickerOption);
		// 
		let formAction = null;
		let zeusStore = {};
		//-> set server sync system param
		zeusStore.serverSync = {};
		zeusStore.serverSync.hasComponent = 'false' == 'true';
		if(zeusStore.serverSync.hasComponent){
			zeusStore.serverSync.serverSyncCheck = 'true';
		}
		//<- set server sync system param
	</script>

	<style>
		:root {
			--img-normal-width: 16%;
			--img-normal-up-top: 28%;
			--img-arrow-width: 12%;
		}

		html {
			font-size: 12px;
		}

		#panel {
			width: 100%;
			height: 100%;
			min-width: 800px;
			min-height: 600px;
		}
		#panel-title{
			font-size: 1.6rem;
		}

		#panel-body-images{
			width: 66%;
		}
		#panel-body-images > #panel-body-images-down {
			padding-top: 2%;
		}
		#panel-body-images > #panel-body-images-down > #panel-body-buy {
			width: 30%;
		}
		#panel-body-images > #panel-body-images-down > #panel-body-charge-release {
			width: 30%;
			padding-left: 1%;
			padding-right: 1%;
			padding-top: 2%; 
		}
		#panel-body-images > #panel-body-images-down > #panel-body-charge-release > div {
			width: 30%;
		}
		#panel-body-images > #panel-body-images-down > #panel-body-generation {
			width: 40%;
		}
		#panel-body-pie {
			width: 35%;
		}

		.pg-img {
			top: 0;
			left: 0;
		}
		.pg-img-tower {
			width: var(--img-normal-width);
			top: var(--img-normal-up-top);
			left: 7%;
		}
		.pg-label-skyline {
			top: 45%;
			left: 43%;
		}
		.pg-img-skyline {
			width: var(--img-normal-width);
			top: var(--img-normal-up-top);
			left: 37%;
		}
		.pg-img-solar-panel {
			width: var(--img-normal-width);
			top: var(--img-normal-up-top);
			left: 72%;
		}
		.pg-img-battery-status {
			width: var(--img-normal-width);
			top: 67%;
			left: 37%;
		}
		.pg-label-battery-status {
			top: 72%;
			left: 56%;
		}
		.pg-img-left-arrow {
			width: var(--img-arrow-width);
			top: 33%;
			left: 54%;
		}
		.pg-img-right-arrow {
			width: var(--img-arrow-width);
			top: 33%;
			left: 24%;
		}
		.pg-img-up-down-arrow {
			width: var(--img-arrow-width);
			top: 52%;
			left: 39%;
		}
	</style>

	<title>
		発電監視
	</title>
</head>
<body>
	<div class="vw-100 vh-100 bg-light d-flex justify-content-center align-items-center">
		<div id="panel" class="d-flex flex-column p-3">

			<div id="panel-title" class="p-3 d-flex justify-content-between align-items-center">
				<label id="text-main-title" class="pg-font-element pg-font-main-title">施設名：東北冷蔵製氷様 本社・第1工場</label>
				<label id="text-main-title" class="pg-font-element pg-font-main-title">2022年6月3日</label>
			</div>

			<div id="panel-body" class="flex-grow-1 d-flex pg-font-element pg-font-normal">

				<div id="panel-body-images" style="position: relative;">
					<img src="./images/powerGeneration/left-arrow-500.gif" style="width: 10%; position: absolute; top: 20%; left: 30%; transform: rotate(210deg);">
					<img src="./images/powerGeneration/left-arrow-500.gif" style="width: 10%; position: absolute; top: 20%; left: 60%; transform: rotate(-30deg);">
					<div class="d-flex flex-column w-100 h-100" style="position: absolute; top: 0; left: 0;">
						<div class="col d-flex">
							<div class="col d-flex justify-content-center align-items-start pt-3">
								<img src="./images/powerGeneration/towers.png" style="width:60%;">
							</div>
							<div class="col d-flex justify-content-center align-items-end">
								<div class="mb-3" style="font-size: 1.6rem;">当施設</div>
							</div>
							<div class="col d-flex justify-content-center align-items-start pt-3">
								<img src="./images/powerGeneration/solar-panels.png" style="width: 60%;">
							</div>
						</div>
						<div class="col d-flex">
							<div class="col d-flex justify-content-center align-items-start">
								<table class="table table-sm table-bordered table-bordered w-auto text-center">
									<tbody>
										<tr>
											<td class="bg-success bg-opacity-25">買電電力</td>
											<td>27kW</td>
										</tr>
										<tr>
											<td class="bg-success bg-opacity-25">供給率</td>
											<td>32%</td>
										</tr>
									</tbody>
								</table>
							</div>
							<div class="col d-flex justify-content-center align-items-center">
								<img src="./images/powerGeneration/skyline.png" class="w-100">
							</div>
							<div class="col d-flex justify-content-center align-items-start">
								<table class="table table-sm table-bordered table-bordered w-auto text-center">
									<tbody>
										<tr>
											<td class="bg-success bg-opacity-25">発電電力（瞬時）</td>
											<td>27kW</td>
										</tr>
										<tr>
											<td class="bg-success bg-opacity-25">当時限の発電電力</td>
											<td>2kWh</td>
										</tr>
										<tr>
											<td class="bg-success bg-opacity-25">供給率</td>
											<td>32%</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="col d-flex">
							<div class="col-4"></div>
							<div class="col-8 pt-3">
								<div class="d-flex">
									<div class="col" align="center">
										<div>本日</div>
									</div>
									<div class="col" align="center">
										<div>今月</div>
									</div>
								</div>
								<div class="ratio" style="--bs-aspect-ratio: 50%;">
									<div id="pie"></div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div id="panel-body-pie" class="p-1 d-flex justify-content-center">
					<div class="w-100 d-flex flex-column justify-content-between text-center p-2">
						<div>
							<div align="center">【使用電力量】</div>
							<div class="d-flex mt-2">
								<div class="col m-0 p-0">
									<ul class="list-group">
										<li class="list-group-item">当日</li>
										<li class="list-group-item">1500kWh</li>
									</ul>
								</div>
								<div class="col m-0 p-0">
									<ul class="list-group">
										<li class="list-group-item">当月</li>
										<li class="list-group-item">6649kWh</li>
									</ul>
								</div>
							</div>
						</div>

						<div>
							<div align="center">【買電・売電電力量】</div>
							<div class="d-flex mt-2">
								<div class="col m-0 p-0">
									<ul class="list-group">
										<li class="list-group-item">当日（買電）</li>
										<li class="list-group-item">1095kWh</li>
										<li class="list-group-item">当日（売電）</li>
										<li class="list-group-item">0kWh</li>
									</ul>
								</div>
								<div class="col m-0 p-0">
									<ul class="list-group">
										<li class="list-group-item">当月（買電）</li>
										<li class="list-group-item">5006kWh</li>
										<li class="list-group-item">当月（売電）</li>
										<li class="list-group-item">0kWh</li>
									</ul>
								</div>
							</div>
						</div>

						<div>
							<div align="center">【発電量】</div>
							<div class="d-flex mt-2">
								<div class="col m-0 p-0">
									<ul class="list-group">
										<li class="list-group-item">当日</li>
										<li class="list-group-item">405kWh</li>
									</ul>
								</div>
								<div class="col m-0 p-0">
									<ul class="list-group">
										<li class="list-group-item">当月</li>
										<li class="list-group-item">1643kWh</li>
									</ul>
								</div>
							</div>
						</div>

						<div>
							<div align="center">【再エネ率】</div>
							<div class="d-flex mt-2">
								<div class="col m-0 p-0">
									<ul class="list-group">
										<li class="list-group-item">当日</li>
										<li class="list-group-item">27%</li>
									</ul>
								</div>
								<div class="col m-0 p-0">
									<ul class="list-group">
										<li class="list-group-item">当月</li>
										<li class="list-group-item">24%</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<script type="text/javascript" src="./js/echarts/echarts.common.min.js"></script>
	<script type="text/javascript" src="./js/component/ResizeByRatio.js"></script>
	<script type="text/javascript" src="./js/zeus/powerGenerationMonitoringPopup.js"></script>
	<script>
		class ElectricityMonitoringPanel {
			#data
			#html
			#fontElements
			#imgElements
			#resizeByRatio
			#storageBatteryItems
			constructor(config){
				this.#data = {
					ratios: {
						panel: {
							x: 4,
							y: 3
						}
					},
					sizes: {
						images: {
							default: 0.12,
							arrows: 0.1
						},
						fonts: {
							percentage: 0.015,
							normal: 0.02,
							mainTitle: 0.04,
							subTitle: 0.03
						}
					},
					positions: {
						tower: {
							top: '41%',
							left: '3.75%'
						}
					},
					current: {
						panelSize: null
					}
				};
				this.#html = document.getElementsByTagName('html')[0];
				this.#resizeByRatio = new ResizeByRatio({
					ratios: this.#data.ratios.panel,
					callbacks: [this.onResize.bind(this)]
				});
				this.#fontElements = Array.from(document.querySelectorAll('.pg-font-element'));
				this.#imgElements = Array.from(document.querySelectorAll('.pg-img'));
				this.#storageBatteryItems = Array.from(document.querySelectorAll('.storage-battery'));
				this.root = document.querySelector(`#${config.id}`);
				this.charts = {
					pie: echarts.init(document.querySelector('#pie'))
				};
				// initialization
				if(config.storageBattery){
					this.#storageBatteryItems.forEach(el => {
						let clazz = el.getAttribute('class');
						el.setAttribute('class', clazz.replace(' d-none', ''));
					});
				}

				this.charts.pie.setOption(graphOption);
			}
			getMainTitleFontSize(){
				return parseInt(this.#data.current.panelSize.height * this.#data.sizes.fonts.mainTitle);
			}
			getSubTitleFontSize(){
				return parseInt(this.#data.current.panelSize.height * this.#data.sizes.fonts.subTitle);
			}
			getNormalFontSize() {
				return parseInt(this.#data.current.panelSize.height * this.#data.sizes.fonts.normal);
			}
			onResize(newSize){
				this.#data.current.panelSize = newSize;
				// resize root div
				this.resizeRoot();
				// resize fonts
				this.resizeFonts();
				// resize graph
				this.charts.pie.resize();
			}
			resizeRoot(size){
				this.root.style.width = `${this.#data.current.panelSize.width}px`;
				this.root.style.height = `${this.#data.current.panelSize.height}px`;
			}
			resizeFonts(){
				this.#html.style.fontSize = `${parseInt(this.#data.current.panelSize.width * this.#data.sizes.fonts.percentage)}px`;
				// main title
				this.#fontElements
				.filter(fontEl => {
					return fontEl.getAttribute('class').indexOf('main-title') >= 0;
				}).forEach(fontElement => {
					//fontElement.style.fontSize = `${this.getMainTitleFontSize()}px`;
				});
				// sub title
				this.#fontElements
				.filter(fontEl => {
					return fontEl.getAttribute('class').indexOf('sub-title') >= 0;
				}).forEach(fontElement => {
					fontElement.style.fontSize = `${this.getSubTitleFontSize()}px`;
				});
				// normal
				this.#fontElements
				.filter(fontEl => {
					return fontEl.getAttribute('class').indexOf('font-normal') >= 0;
				})
				.forEach(fontEl => {
					fontEl.style.fontSize = `${this.getNormalFontSize()}px`;
				});
			}
		}

		let panel = new ElectricityMonitoringPanel({
			id: 'panel',
			storageBattery: false
		});
		panel.onResize({width: 800, height: 600});
	</script>
</body>
</html>